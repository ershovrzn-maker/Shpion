<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Игра «Шпион»</title>

<style>
  body{
    margin:0;
    font-family:system-ui, Arial, sans-serif;
    background:#0b0f1a;
    color:#e9eefc;
  }

  .wrap{
    max-width:720px;
    margin:0 auto;
    padding:20px;
  }

  h1{
    font-size:22px;
    margin:0 0 14px 0;
    text-align:center;
  }

  .panel{
    background:#121a2b;
    border-radius:14px;
    padding:16px;
  }

  .row{
    display:flex;
    gap:10px;
    margin-bottom:10px;
    flex-wrap:wrap;
  }

  input, select{
    flex:1;
    padding:10px;
    border-radius:10px;
    border:none;
    font-size:14px;
  }

  button{
    padding:10px 14px;
    border-radius:10px;
    border:none;
    cursor:pointer;
    font-weight:600;
  }

  .add{background:#2a3b67;color:#fff;}
  .play{background:#7aa2ff;color:#081022;}
  .reset{background:#1f2c4c;color:#fff;}
  .danger{background:#4c1f2a;color:#fff;}

  .list{
    margin-top:6px;
    text-align:center;
  }

  .pill{
    display:inline-flex;
    align-items:center;
    gap:8px;
    background:rgba(255,255,255,.08);
    padding:6px 10px;
    border-radius:8px;
    margin:4px;
    font-size:14px;
  }

  .pill .x{
    width:20px;
    height:20px;
    border-radius:6px;
    background:rgba(255,255,255,.15);
    border:none;
    color:#fff;
    cursor:pointer;
    font-weight:800;
  }

  .hint{
    font-size:13px;
    color:#9fb0d0;
    margin:12px 0;
    text-align:center;
    line-height:1.35;
  }

  /* ВСЕ КАРТОЧКИ В ОДИН СТОЛБИК */
  .grid{
    display:flex;
    flex-direction:column;
    gap:12px;
    margin-top:12px;
  }

  .card{
    background:rgba(255,255,255,.04);
    border-radius:12px;
    padding:12px;
  }

  /* ИМЯ ПО ЦЕНТРУ */
  .namebtn{
    width:100%;
    padding:14px;
    border-radius:10px;
    background:rgba(255,255,255,.06);
    color:#fff;
    border:none;
    font-weight:700;
    font-size:16px;
    text-align:center;
  }

  .role{
    margin-top:12px;
    padding:14px;
    background:rgba(0,0,0,.25);
    border-radius:10px;
    font-weight:700;
    text-align:center;
  }

  .role.spy{
    background:rgba(122,162,255,.18);
    border:1px solid rgba(122,162,255,.35);
  }

  .char{
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:8px;
  }

  .char img{
    width:min(80vw, 300px);
    height:min(80vw, 300px);
    object-fit:cover;
    border-radius:16px;
    border:1px solid rgba(255,255,255,.2);
    background:rgba(255,255,255,.04);
  }

  .charname{
    font-size:16px;
    font-weight:800;
  }
</style>
</head>

<body>
<div class="wrap">
  <h1>Игра «Шпион»</h1>

  <div class="panel">
    <div class="row">
      <select id="universe">
        <option value="harry">Гарри Поттер</option>
        <option value="marvel">Marvel</option>
      </select>

      <select id="spyCount"></select>
    </div>

    <div class="row">
      <input id="nameInput" placeholder="Имя игрока">
      <button class="add" id="addBtn">Добавить</button>
      <button class="danger" id="delBtn">Удалить</button>
    </div>

    <div class="list" id="players"></div>

    <div class="row">
      <button class="play" id="playBtn">Играть</button>
      <button class="reset" id="resetBtn">Сброс</button>
    </div>

    <div class="hint">
      Нажмите «Играть».<br>
      Нажмите на имя, чтобы увидеть роль.<br>
      Повторный клик убирает карточку.
    </div>

    <div class="grid" id="grid"></div>
  </div>
</div>

<script>
  const UNIVERSES = {
    harry:[
      {name:"Гарри Поттер",img:"img/harry/harry.jpg"},
      {name:"Гермиона Грейнджер",img:"img/harry/hermione.jpg"},
      {name:"Рон Уизли",img:"img/harry/ron.jpg"},
      {name:"Драко Малфой",img:"img/harry/draco.jpg"}
    ],
    marvel:[
      {name:"Тони Старк",img:"img/marvel/tony.jpg"},
      {name:"Стив Роджерс",img:"img/marvel/steve.jpg"},
      {name:"Тор",img:"img/marvel/thor.jpg"},
      {name:"Локи",img:"img/marvel/loki.jpg"}
    ]
  };

  const players=[];
  const playersEl=document.getElementById("players");
  const grid=document.getElementById("grid");
  const spyCount=document.getElementById("spyCount");

  function updateSpyCount(){
    spyCount.innerHTML="";
    if(players.length<3){
      spyCount.innerHTML="<option>1 шпион</option>";
      return;
    }
    const max=Math.min(players.length-1,Math.floor(players.length/2));
    for(let i=0;i<=max;i++){
      const o=document.createElement("option");
      o.value=i;
      o.textContent=i+" шпион"+(i===1?"":"ов");
      spyCount.appendChild(o);
    }
  }

  function renderPlayers(){
    playersEl.innerHTML="";
    players.forEach((p,i)=>{
      const pill=document.createElement("span");
      pill.className="pill";
      pill.textContent=p;
      const x=document.createElement("button");
      x.className="x";
      x.textContent="×";
      x.onclick=()=>{players.splice(i,1);renderPlayers();};
      pill.appendChild(x);
      playersEl.appendChild(pill);
    });
    updateSpyCount();
  }

  document.getElementById("addBtn").onclick=()=>{
    const v=document.getElementById("nameInput").value.trim();
    if(!v||players.includes(v))return;
    players.push(v);
    document.getElementById("nameInput").value="";
    renderPlayers();
  };

  document.getElementById("delBtn").onclick=()=>{
    players.pop();
    renderPlayers();
  };

  document.getElementById("playBtn").onclick=()=>{
    if(players.length<3)return;
    grid.innerHTML="";

    const chars=UNIVERSES[document.getElementById("universe").value];
    const common=chars[Math.floor(Math.random()*chars.length)];

    const spies=new Set();
    const k=parseInt(spyCount.value||"1",10);
    while(spies.size<k)spies.add(Math.floor(Math.random()*players.length));

    players.forEach((name,i)=>{
      const card=document.createElement("div");
      card.className="card";

      const btn=document.createElement("button");
      btn.className="namebtn";
      btn.textContent=name;

      let open=false;
      btn.onclick=()=>{
        if(!open){
          open=true;
          const role=document.createElement("div");
          role.className="role"+(spies.has(i)?" spy":"");
          if(spies.has(i)){
            role.textContent="ТЫ ШПИОН";
          }else{
            const wrap=document.createElement("div");
            wrap.className="char";
            const img=document.createElement("img");
            img.src=common.img;
            const nm=document.createElement("div");
            nm.className="charname";
            nm.textContent=common.name;
            wrap.appendChild(img);
            wrap.appendChild(nm);
            role.appendChild(wrap);
          }
          card.appendChild(role);
        }else{
          card.remove();
        }
      };

      card.appendChild(btn);
      grid.appendChild(card);
    });
  };

  document.getElementById("resetBtn").onclick=()=>{
    players.length=0;
    playersEl.innerHTML="";
    grid.innerHTML="";
    updateSpyCount();
  };
</script>
</body>
</html>
