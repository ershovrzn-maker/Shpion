<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Шпион</title>

<style>
body {
  margin: 0;
  font-family: system-ui, Arial, sans-serif;
  background: #0b0f1a;
  color: #e9eefc;
}
.wrap {
  max-width: 720px;
  margin: 0 auto;
  padding: 20px;
}
h1 {
  font-size: 22px;
  margin-bottom: 14px;
}
.panel {
  background: #121a2b;
  border-radius: 14px;
  padding: 16px;
}
.row {
  display: flex;
  gap: 10px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}
input, select {
  flex: 1;
  padding: 10px;
  border-radius: 10px;
  border: none;
  font-size: 14px;
}
button {
  padding: 10px 14px;
  border-radius: 10px;
  border: none;
  cursor: pointer;
  font-weight: 600;
}
.add { background: #2a3b67; color: #fff; }
.play { background: #7aa2ff; color: #081022; }
.reset { background: #1f2c4c; color: #fff; }

.list span {
  display: inline-block;
  background: rgba(255,255,255,.08);
  padding: 6px 10px;
  border-radius: 8px;
  margin: 4px 6px 0 0;
  font-size: 13px;
}

.grid {
  display: grid;
  gap: 10px;
  margin-top: 12px;
}
@media (min-width: 600px) {
  .grid { grid-template-columns: 1fr 1fr; }
}

.card {
  background: rgba(255,255,255,.04);
  border-radius: 12px;
  padding: 12px;
}
.namebtn {
  width: 100%;
  padding: 12px;
  border-radius: 10px;
  background: rgba(255,255,255,.06);
  color: #fff;
  border: none;
  font-weight: 700;
}
.role {
  margin-top: 10px;
  padding: 10px;
  background: rgba(0,0,0,.25);
  border-radius: 10px;
}
.hint {
  font-size: 13px;
  color: #9fb0d0;
  margin-bottom: 10px;
}
</style>
</head>

<body>
<div class="wrap">
<h1>Игра «Шпион»</h1>

<div class="panel">

  <div class="row">
    <select id="universe">
      <option value="data/harry_potter.json">Гарри Поттер</option>
      <option value="data/marvel.json">Marvel</option>
      <option value="data/sherlock.json">Шерлок Холмс</option>
      <option value="data/star_wars.json">Звёздные войны</option>
    </select>
  </div>

  <div class="row">
    <input id="nameInput" placeholder="Имя игрока">
    <button class="add" id="addBtn">Добавить</button>
  </div>

  <div class="list" id="playerList"></div>

  <div class="row">
    <button class="play" id="playBtn">Играть</button>
    <button class="reset" id="resetBtn">Сброс</button>
  </div>

  <div class="hint">
    Нажми «Играть». Нажми на имя — увидишь роль. Нажми ещё раз — карточка исчезнет.
  </div>

  <div class="grid" id="grid"></div>

</div>
</div>

<script>
let players = [];
let characters = [];

const nameInput = document.getElementById("nameInput");
const playerList = document.getElementById("playerList");
const grid = document.getElementById("grid");

document.getElementById("addBtn").onclick = () => {
  const name = nameInput.value.trim();
  if (!name) return;
  players.push(name);
  nameInput.value = "";
  renderPlayers();
};

document.getElementById("resetBtn").onclick = () => {
  players = [];
  grid.innerHTML = "";
  renderPlayers();
};

function renderPlayers() {
  playerList.innerHTML = "";
  players.forEach(n => {
    const s = document.createElement("span");
    s.textContent = n;
    playerList.appendChild(s);
  });
}

function rand(n) {
  return Math.floor(Math.random() * n);
}

async function loadCharacters() {
  const path = document.getElementById("universe").value;
  const r = await fetch(path);
  if (!r.ok) {
    alert("Не удалось загрузить вселенную");
    return [];
  }
  return await r.json();
}

document.getElementById("playBtn").onclick = async () => {
  if (players.length < 3) {
    alert("Минимум 3 игрока");
    return;
  }

  characters = await loadCharacters();
  if (!characters.length) return;

  const spyIndex = rand(players.length);
  const commonCharacter = characters[rand(characters.length)];

  grid.innerHTML = "";

  players
    .map((name, i) => ({
      name,
      role: i === spyIndex ? "ТЫ ШПИОН" : commonCharacter
    }))
    .sort(() => Math.random() - 0.5)
    .forEach(p => {
      const card = document.createElement("div");
      card.className = "card";

      const btn = document.createElement("button");
      btn.className = "namebtn";
      btn.textContent = p.name;

      let opened = false;
      btn.onclick = () => {
        if (!opened) {
          opened = true;
          const role = document.createElement("div");
          role.className = "role";
          role.textContent = p.role;
          card.appendChild(role);
        } else {
          card.remove();
        }
      };

      card.appendChild(btn);
      grid.appendChild(card);
    });
};
</script>
</body>
</html>

